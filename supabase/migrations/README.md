# Миграции базы данных

## Применение миграций

### Через Supabase Dashboard

1. Откройте Supabase Dashboard
2. Перейдите в SQL Editor
3. Скопируйте содержимое файла миграции
4. Выполните SQL запрос

### Через Supabase CLI

```bash
# Применить все миграции
supabase db push

# Или применить конкретную миграцию
supabase migration up 20250101000000_create_default_categories
```

## Миграции

### 20250101000000_create_default_categories.sql

Создаёт предустановленные категории для новых пользователей.

**Что делает:**

- Создаёт функцию `create_default_categories(UUID)` для создания набора категорий
- Модифицирует триггер `on_auth_user_created` для автоматического создания категорий при регистрации

**Категории:**

- 4 категории доходов
- 8 основных категорий расходов
- 7 подкатегорий (для Еды, Транспорта, Жилья)

**Безопасность:**

- Использует `ON CONFLICT DO NOTHING` для профилей
- Проверяет наличие категорий перед созданием
- Не создаёт дубликаты

### 20250116000000_allow_null_default_currency.sql

Разрешает NULL для поля `default_currency` в таблице `profiles`.

**Что делает:**

- Удаляет NOT NULL constraint с поля `default_currency`
- Позволяет использовать NULL для обозначения "не прошел онбординг"

**Важно:**

- После применения миграции `default_currency` может быть NULL
- NULL означает, что пользователь не прошел онбординг
- При прохождении онбординга устанавливается валюта (RUB, USD, EUR)
